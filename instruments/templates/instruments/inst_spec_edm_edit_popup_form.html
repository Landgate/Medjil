<!--

   Â© 2023 Western Australian Land Information Authority

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

-->
{% extends 'base_popup.html' %}
{% load i18n %}
{% load static %}

{% block content %}
<article class="post">
    <div class="post-content">
        <form action="" class="site-form" method="post">
            {% csrf_token %}
            <div class="mb-5 site-form-header bg-indigo-300 rounded px-2">
                <h2 class="text-center">
                    {% if form.instance.pk %}
                        Edit EDM Model Specifications
                    {% else %}
                        Create EDM Model Specifications
                    {% endif %}
                </h2>
            </div>
            {% if form.non_field_errors %}
                <div class="mt-5 mb-3">
                    <b>Non field error {{ form.non_field_errors }}</b><br>
                </div>
            {% endif %}
            <table>
                <!-- EDM Owner -->
                <tr title="{{ form.edm_owner.help_text }}">
                    <td width="35%">{{ form.edm_owner.label }}</td>
                    <td width="45%">{{ form.edm_owner }}</td>
                    <td width="15%"></td>
                </tr>
                <!-- EDM Model -->
                <tr title="{{ form.edm_model.help_text }}">
                    <td width="35%">{{ form.edm_model.label }}</td>
                    <td width="45%">{{ form.edm_model }}</td>
                    <td width="15%">
                        <a href="/instruments/inst_model_createby_inst_type/edm/" target="_blank" 
                        class="ml-3 px-2 py-1 bg-green-400 border-transparent hover:border-gray-900 rounded text-lg text-white cursor-pointer" 
                        onclick="return showAddPopup(this);" id="add_level">&#43;</a>
                    </td>
                </tr>
                <tr>
                    <td>EDM Specifications Lookup Table</td>
                    <td>
                      <a href="/instruments/edm_recommended_specifications/" target="_blank" onclick="return showAddPopup(this);">
                            <svg version="1.0" xmlns="http://www.w3.org/2000/svg" id="search-book"
                             width="44.000000pt" height="30.000000pt" viewBox="0 0 66.000000 49.000000"
                             preserveAspectRatio="xMidYMid meet">
                            
                            <g transform="translate(0.000000,49.000000) scale(0.100000,-0.100000)"
                            fill="#000000" stroke="none">
                            <path d="M91 479 c-19 -6 -35 -18 -38 -30 -3 -12 -14 -19 -29 -19 l-24 0 0
                            -205 0 -205 134 0 c79 0 137 -4 141 -10 8 -13 102 -13 110 0 4 6 62 10 141 10
                            l134 0 0 205 0 205 -25 0 c-18 0 -25 5 -25 19 0 29 -82 45 -183 37 -95 -8 -84
                            -8 -207 -1 -52 2 -110 0 -129 -6z m19 -66 c0 -54 1 -55 19 -39 16 15 19 15 31
                            1 22 -27 30 -16 30 41 l0 56 48 -6 c80 -12 82 -13 82 -57 0 -21 5 -39 10 -39
                            6 0 10 18 10 39 l0 40 57 11 c51 11 131 8 168 -6 13 -5 15 -36 15 -186 l0
                            -179 -22 7 c-29 9 -167 9 -196 0 -21 -7 -22 -5 -22 58 0 37 -4 66 -10 66 -6 0
                            -10 -29 -10 -66 0 -63 -1 -65 -22 -58 -29 9 -167 9 -196 0 l-22 -7 0 190 c0
                            163 2 191 15 191 12 0 15 -13 15 -57z m60 16 c0 -33 -3 -39 -13 -30 -10 8 -17
                            7 -25 -1 -9 -9 -12 -2 -12 30 0 38 2 42 25 42 23 0 25 -4 25 -41z m-118 -196
                            l3 -168 35 5 c19 3 70 4 113 3 96 -1 154 -1 260 1 45 0 97 -3 115 -7 l32 -9 0
                            171 c0 145 2 171 15 171 13 0 15 -27 15 -180 l0 -180 -134 0 c-79 0 -137 -4
                            -141 -10 -8 -13 -62 -13 -70 0 -4 6 -62 10 -141 10 l-134 0 0 180 c0 152 2
                            180 15 180 12 0 15 -28 17 -167z"/>
                            <path d="M206 366 c-20 -18 -26 -33 -26 -68 0 -24 6 -50 13 -57 9 -11 9 -14 0
                            -18 -18 -7 -55 -71 -48 -83 12 -19 41 -10 58 20 10 17 15 35 12 40 -4 6 11 10
                            38 10 55 0 81 25 80 77 -1 46 -19 78 -50 92 -35 16 -49 14 -77 -13z m93 -22
                            c27 -34 27 -74 1 -102 -27 -29 -55 -28 -85 3 -33 32 -34 87 -3 109 33 23 64
                            19 87 -10z m-113 -180 c-10 -14 -20 -23 -23 -20 -3 3 2 17 11 32 10 14 20 23
                            23 20 3 -3 -2 -17 -11 -32z"/>
                            <path d="M400 360 c0 -6 27 -10 60 -10 33 0 60 4 60 10 0 6 -27 10 -60 10 -33
                            0 -60 -4 -60 -10z"/>
                            <path d="M400 310 c0 -6 27 -10 61 -10 37 0 58 4 54 10 -3 6 -31 10 -61 10
                            -30 0 -54 -4 -54 -10z"/>
                            <path d="M400 260 c0 -5 18 -10 40 -10 22 0 40 5 40 10 0 6 -18 10 -40 10 -22
                            0 -40 -4 -40 -10z"/>
                            </g>
                            </svg>
                      </a>
                    </td>
                </tr>
                <!-- Manufacturers Accuracy Statement -->
                <tr title="{{ form.manu_unc_const.help_text }}">
                    <td width="35%">{{ form.manu_unc_const.label|title }}<a href= "{% url 'calibrationguide:manual_view' %}#Chapter_4"> &#x1F6C8</a></td>
                    <td width="45%">{{ form.manu_unc_const }}
                        {% for error in form.manu_unc_const.errors %}
                            <p class="error error-danger">{{ error }}</p>
                        {% endfor %}
                    </td>
                    <td width="15%">{{ form.units_manu_unc_const }}</td>
                </tr>
                <tr title="{{ form.manu_unc_ppm.help_text }}">
                    <td width="35%">{{ form.manu_unc_ppm.label|title }}<a href= "{% url 'calibrationguide:manual_view' %}#Chapter_4"> &#x1F6C8</a></td>
                    <td width="45%">{{ form.manu_unc_ppm }}
                        {% for error in form.manu_unc_ppm.errors %}
                            <p class="error error-danger">{{ error }}</p>
                        {% endfor %}
                    </td>
                    <td width="15%">{{ form.units_manu_unc_ppm }}</td>
                </tr>
                <tr title="{{ form.manu_unc_k.help_text }}">
                    <td width="35%">{{ form.manu_unc_k.label|title }}</td>
                    <td width="45%">{{ form.manu_unc_k }}
                        {% for error in form.manu_unc_k.errors %}
                            <p class="error error-danger">{{ error }}</p>
                        {% endfor %}
                    </td>
                    <td width="15%"></td>
                </tr>
                <!-- Unit Length -->
                <tr title="{{ form.edm_type.help_text }}">
                    <td width="35%">{{ form.edm_type.label }}</td>
                    <td width="45%">{{ form.edm_type }}
                        {% for error in form.edm_type.errors %}
                            <p class="error error-danger">{{ error }}</p>
                        {% endfor %}
                    </td>
                    <td width="15%"></td>
                </tr>
                <!-- Unit Length -->
                <tr title="{{ form.unit_length.help_text }}">
                    <td width="35%">{{ form.unit_length.label|title }}</td>
                    <td width="45%">{{ form.unit_length }}
                        {% for error in form.unit_length.errors %}
                            <p class="error error-danger">{{ error }}</p>
                        {% endfor %}
                    </td>
                    <td width="15%">{{ form.units_unit_length }}</td>
                </tr>
                <!-- Frequency -->
                <tr title="{{ form.frequency.help_text }}">
                    <td width="35%">{{ form.frequency.label|title }}</td>
                    <td width="45%">{{ form.frequency }}
                        {% for error in form.frequency.errors %}
                            <p class="error error-danger">{{ error }}</p>
                        {% endfor %}
                    </td>
                    <td width="15%">{{ form.units_frequency }}</td>
                </tr>
                <!-- Wavelength -->
                <tr title="{{ form.carrier_wavelength.help_text }}">
                    <td width="35%">{{ form.carrier_wavelength.label|title }}</td>
                    <td width="45%">{{ form.carrier_wavelength }}
                        {% for error in form.carrier_wavelength.errors %}
                            <p class="error error-danger">{{ error }}</p>
                        {% endfor %}
                    </td>
                    <td width="15%">{{ form.units_carrier_wavelength }}</td>
                </tr>
                <tr title="{{ form.manu_ref_refrac_index.help_text }}">
                    <td width="35%">{{ form.manu_ref_refrac_index.label|title }}</td>
                    <td width="45%">{{ form.manu_ref_refrac_index }}
                        {% for error in form.manu_ref_refrac_index.errors %}
                            <p class="error error-danger">{{ error }}</p>
                        {% endfor %}
                    </td>
                    <td width="15%"></td>
                </tr>
                <tr title="{{ form.c_term.help_text }}">
                    <td width="35%">{{ form.c_term.label|title }}</td>
                    <td width="45%">{{ form.c_term }}
                        {% for error in form.c_term.errors %}
                            <p class="error error-danger">{{ error }}</p>
                        {% endfor %}
                    </td>
                    <td width="15%"></td>
                </tr>
                <tr title="{{ form.d_term.help_text }}">
                    <td width="35%">{{ form.d_term.label|title }}</td>
                    <td width="45%">{{ form.d_term }}
                        {% for error in form.d_term.errors %}
                            <p class="error error-danger">{{ error }}</p>
                        {% endfor %}
                    </td>
                    <td width="15%"></td>
                </tr>
                <tr title="{{ form.measurement_increments.help_text }}">
                    <td width="35%">{{ form.measurement_increments.label|title }}</td>
                    <td width="45%">{{ form.measurement_increments }}
                        {% for error in form.measurement_increments.errors %}
                            <p class="error error-danger">{{ error }}</p>
                        {% endfor %}
                    </td>
                    <td width="15%">{{ form.units_measurement_inc }}</td>
                </tr>
            </table>

            {% if request.GET.next %}
                <input type="hidden" name="next" value="{{ request.GET.next }}">
            {% endif %}
            <div class="button-container">
                <button class="submit-button bg-green-500 hover:bg-green-400 text-base" type="submit">Save</button>
            </div>
        </form>
    </div>
</article>

<script>
    window.onload = function() {
        if(!window.location.hash) {
            window.location = window.location + '#loaded';
            window.location.reload();
        }
    }
    
    function showAddPopup(triggeringLink) {
        var name = triggeringLink.id.replace(/^add_/, '');
        href = triggeringLink.href;
        var win = window.open(href, name, "toolbar=yes,scrollbars=yes,resizable=yes,top=200,left=850,width=600,height=420");
        win.focus();
        return false;
    }

    modelOptions = document.querySelector("#id_edm_model")
    function closePopup(win, newID, newRepr) {
        window.sessionStorage.setItem('new_model',  newID);
        win.close();
    }
    

    let newModelValue = sessionStorage.getItem('new_model');
    if (newModelValue) {
        for(var i = 0;i 
    < modelOptions.options.length;i++){
                if(modelOptions.options[i].value == newModelValue ){
                    modelOptions.options[i].selected = true;
                }
            }
        
        window.sessionStorage.removeItem('new_model');
    }
    //  Refresh Parent Function
    function refreshParent() 
        {
            window.opener.location.reload(true);
        }
</script>
<body onunload="javascript:refreshParent()">

{% endblock %}
