<!--

   Â© 2023 Western Australian Land Information Authority

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

-->
{% load static %}
{% load custom_filter_tags %}

<div class="text-center">
    <div class="flexbox-item_800_IB text-right" style="margin-left: auto; margin-right: auto">
            <i><B>Reference: </B>I{{ pillar_survey.pk|stringformat:"06d" }}</i>
    </div>
    <h1>
        <B>EDMI Calibration Report</B>
    </h1>
</div>
<div class="flexbox-container_IB">
    <div class="flexbox-item_400_IB flexbox-item-left_IB">
        <br>
        <B>Calibration Site: </B>{{ baseline.site }}
        <br>
        <B>Location: </B>{{ baseline.site.site_address }}
        <br>
        <B>Address: </B>{{ baseline.site.locality }}, {{ baseline.site.state }}, {{ baseline.site.country }}
        <br>
        <B>Job Reference: </B>{{ pillar_survey.job_number }}
    </div>
    <div class="flexbox-item_400_IB flexbox-item-right_IB">
        <br>
        <B>Instrument Operator: </B>{{ pillar_survey.observer }}
        <br>
        <B>Observation Date: </B>{{ pillar_survey.survey_date }}
        <br>
        <B>Computation date: </B>{{ pillar_survey.computation_date }}
        <br>
        <B>Weather Conditions: </B>{{ pillar_survey.weather }}
    </div>
</div>
<div class="flexbox-container_IB">
    <div class="flexbox-item_800_IB  flexbox-item-left_IB">
        <hr>
    </div>
</div>
<div class="text-center">
    <h2>Instruments' Details</h2>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_400_IB flexbox-item-left_IB">
            <B>
                <u>Electronic Distance Measuring Instrument (EDMI)</u>
            </B>
            <br>
                <B>Make: </B>{{ pillar_survey.edm.edm_specs.edm_make_name }}
                <br>
                <B>Model: </B>{{ pillar_survey.edm.edm_specs.edm_model_name }}
                <br>
                <B>Serial Number: </B>{{ pillar_survey.edm.edm_number }}
                <br>
                <B>Unit Length: </B>{{ pillar_survey.edm.edm_specs.unit_length }}m
                <br>
                <B>Manufacturers Reference Refractive Index: </B>{{ pillar_survey.edm.edm_specs.manu_ref_refrac_index }}
        </div>
        <div class="flexbox-item_400_IB  flexbox-item-right_IB">
            <br>
            <B>Manufacturers Uncertainty: </B>{{ pillar_survey.edm.edm_specs.manu_unc_const }}mm &plusmn {{ pillar_survey.edm.edm_specs.manu_unc_ppm }}ppm, k={{ pillar_survey.edm.edm_specs.manu_unc_k }}
            <br>
            <B>Carrier Wavelength: </B>{{ pillar_survey.edm.edm_specs.carrier_wavelength }}nm
            <br>
            <B>EDM Type: </B>{{ pillar_survey.edm.edm_specs.get_edm_type_display }}
            <br>
            <B>Frequency: </B>{{ pillar_survey.edm.edm_specs.frequency }}Hz
        </div>
    </div>
    
    <div class="flexbox-container_IB">
    {% if pillar_survey.mets_applied %}
        <div class="flexbox-item_800_IB flexbox-item-left_IB">The first velocity atmospheric corrections were applied to the raw observations prior to data import to Medjil.</div>
    {% else %}
        <div class="flexbox-item_800_IB flexbox-item-left_IB">
        {% if pillar_survey.edm.edm_specs.atmos_corr_formula %}
        <p>Raw EDM measurements imported to Medjil have been corrected with the first velocity correction using the following formula:</p>
            <ul style="padding-left: 40px;">
            {% for f_row in pillar_survey.edm.edm_specs.atmos_corr_formula.splitlines %}
                {{ f_row }}<br>
            {% endfor %}
            </ul>
        </p>
        {% else %}
        <p>Raw EDM measurements imported to Medjil have been corrected with the first velocity correction using the following parameters:
        <a href="/calibrationguide/read_manual/edmi_calibration_manual.html#EDMI-Chapter4_2" target="_blank" onclick="return PopupTechnicalManual(this);"> ðŸ›ˆ</a></p>
        <ul style="padding-left: 40px;">
            <li><b>C Term</b> = {{ pillar_survey.edm.edm_specs.c_term }}</li>
            <li><b>D Term</b> = {{ pillar_survey.edm.edm_specs.d_term }}</li>
        </ul>
        {% endif %}
        </div>
    {% endif %}
    </div>
    
    <div class="flexbox-container_IB">
        <div class="flexbox-item_400_IB flexbox-item-left_IB">
            <br>
            <B>
                <u>Prism</u>
            </B>
            <br>
            <B>Make: </B>{{ pillar_survey.prism.prism_specs.prism_make_name }}
            <br>
            <B>Model: </B>{{ pillar_survey.prism.prism_specs.prism_model_name }}
            <br>
            <B>Serial Number: </B>{{ pillar_survey.prism.prism_number }}
        </div>
        <div class="flexbox-item_400_IB  flexbox-item-right_IB">
            <br>
            <br>
            <B>Manufacturers Uncertainty: </B>{{ pillar_survey.prism.prism_specs.manu_unc_const }}mm, k={{ pillar_survey.prism.prism_specs.manu_unc_k }}
        </div>
    </div>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_400_IB flexbox-item-left_IB">
            <br>
            <B>
                <u>Thermometer</u>
            </B>
            <br>
            <B>Make: </B>{{ pillar_survey.thermometer.mets_specs.mets_make_name }}
            <br>
            <B>Model: </B>{{ pillar_survey.thermometer.mets_specs.mets_model_name }}
            <br>
            <B>Serial Number: </B>{{ pillar_survey.thermometer.mets_number }}
        </div>
        <div class="flexbox-item_400_IB  flexbox-item-right_IB">
            <br>
            <br>
            <B>Manufacturers Uncertainty: </B>{{ pillar_survey.thermometer.mets_specs.manu_unc_const }} &#186C, k={{ pillar_survey.thermometer.mets_specs.manu_unc_k }}
            <br>
            <B>Calibration Date: </B>{{ calib.them.calibration_date }}
            {% if calib.them.certificate_upload %}
                <br>
                <a href="{{ calib.them.certificate_upload.url }}" target="_blank" rel="noopener noreferrer">Download Calibration Certificate &#10515</a>
            {% endif %}
        </div>
    </div>
    
    <div class="flexbox-container_IB">
        {% if not pillar_survey.thermo_calib_applied %}
            <div class="flexbox-item_800_IB flexbox-item-left_IB">
                A calibration correction has been applied to the raw temperature measurements imported to Medjil using the most recent calibration at the time of the pillar survey and the following parameters:
                <ul style="padding-left: 40px;">
                    <li><b>Zero Point Correction</b> = {{ calib.them.zero_point_correction }}</li>
                </ul>
            </div>
        {% endif %}
    </div>
    
    <div class="flexbox-container_IB">
        <div class="flexbox-item_400_IB flexbox-item-left_IB">
            <br>
            <B>
                <u>Barometer</u>
            </B>
            <br>
            <B>Make: </B>{{ pillar_survey.barometer.mets_specs.mets_make_name }}
            <br>
            <B>Model: </B>{{ pillar_survey.barometer.mets_specs.mets_model_name }}
            <br>
            <B>Serial Number: </B>{{ pillar_survey.barometer.mets_number }}
        </div>
        <div class="flexbox-item_400_IB  flexbox-item-right_IB">
            <br>
            <br>
            <B>Manufacturers Uncertainty: </B>{{ pillar_survey.barometer.mets_specs.manu_unc_const }} hPa, k={{ pillar_survey.barometer.mets_specs.manu_unc_k }}
            <br>
            <B>Calibration Date: </B>{{ calib.baro.calibration_date }}
            {% if calib.baro.certificate_upload %}
                <br>
                <a href="{{ calib.baro.certificate_upload.url }}" target="_blank" rel="noopener noreferrer">Download Calibration Certificate &#10515</a>
            {% endif %}
        </div>
    </div>
    <div class="flexbox-container_IB">
        {% if not pillar_survey.baro_calib_applied %}
            <div class="flexbox-item_800_IB flexbox-item-left_IB">
                A calibration correction has been applied to the raw pressure measurements imported to Medjil using the most recent calibration at the time of the pillar survey and the following parameters:
                <ul style="padding-left: 40px;">
                    <li><b>Zero Point Correction</b> = {{ calib.baro.zero_point_correction }}</li>
                </ul>
            </div>
        {% endif %}
    </div>
    
    <div class="flexbox-container_IB">
        <div class="flexbox-item_400_IB flexbox-item-left_IB">
            <br>
            <B>
                <u>Hygrometer</u>
            </B>
            <br>
            <B>Make: </B>{{ pillar_survey.hygrometer.mets_specs.mets_make_name }}
            <br>
            <B>Model: </B>{{ pillar_survey.hygrometer.mets_specs.mets_model_name }}
            <br>
            <B>Serial Number: </B>{{ pillar_survey.hygrometer.mets_number }}
        </div>
        <div class="flexbox-item_400_IB  flexbox-item-right_IB">
            <br>
            <br>
            <B>Manufacturers Uncertainty: </B>{{ pillar_survey.hygrometer.mets_specs.manu_unc_const }} &#37, k={{ pillar_survey.hygrometer.mets_specs.manu_unc_k }}
            <br>
            <B>Calibration Date: </B>{{ calib.hygro.calibration_date }}
            {% if calib.hygro.certificate_upload %}
                <br>
                <a href="{{ calib.hygro.certificate_upload.url }}" target="_blank" rel="noopener noreferrer">Download Calibration Certificate &#10515</a>
            {% endif %}
        </div>
    </div>
    <div class="flexbox-container_IB">
        {% if not pillar_survey.hygro_calib_applied %}
            <div class="flexbox-item_800_IB flexbox-item-left_IB">
                A calibration correction has been applied to the raw humidity measurements imported to Medjil using the most recent calibration at the time of the pillar survey and the following parameters:
                <ul style="padding-left: 40px;">
                    <li><b>Zero Point Correction</b> = {{ calib.hygro.zero_point_correction }}</li>
                </ul>
            </div>
        {% endif %}
    </div>
    
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB  flexbox-item-left_IB">
            <hr>
        </div>
    </div>
</div>
<div class="text-center">
    <h2>{{ baseline.site }} Baseline Details</h2>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_400_IB flexbox-item-left_IB">
            <B>Date of Accreditation: </B>{{ baseline.calibrated_baseline.accreditation.valid_from_date }}
            <br>
            <B>Accreditation Valid Until: </B>{{ baseline.calibrated_baseline.accreditation.valid_to_date }}
            <br>
            <B>Accredited Agency: </B>{{ baseline.calibrated_baseline.accreditation.accredited_company }}
        </div>
        <div class="flexbox-item_400_IB  flexbox-item-right_IB">
            <B>Date of Baseline Calibration Survey: </B>{{ baseline.calibrated_baseline.survey_date }}
            <br>
            <B>Date of Calibration Certification: </B>{{ baseline.calibrated_baseline.computation_date }}
            {% if baseline.calibrated_baseline.accreditation.certificate_upload %}
                <br>
                <a href="{{ baseline.calibrated_baseline.accreditation.certificate_upload.url }}" target="_blank" rel="noopener noreferrer">Download Acreditation Certificate &#10515</a>
            {% endif %}
        </div>
    </div>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB flexbox-item-left_IB">
            <br>
            <B>Accreditation Statement: </B>{{ baseline.calibrated_baseline.accreditation.statement }}
        </div>
    </div>
</div>
<div class="text-center">
    <h2>Certified Baseline Distances Used</h2>
    <table style="margin-left:auto;margin-right:auto;font-size:10.0pt;width:800px;">
        <tr>
            <th class="text-center">To</th>
            <th class="text-center"  colspan = '3'>Reduced Distance</th>
            <th class="text-center"  colspan = '3'>Offset</th>
            <th class="text-center"  colspan = '3'>Reduced Level</th>
        </tr>
        <tr>
            <th class="text-center">Pillar</th>
            <th class="text-center">Distance (m)</th>
            <th class="text-center">Uncertainty (m)</th>
            <th class="text-center">k</th>
            <th class="text-center">Offset (m)</th>
            <th class="text-center">Uncertainty (m)</th>
            <th class="text-center">k</th>
            <th class="text-center">Reduced Level (mAHD)</th>
            <th class="text-center">Uncertainty (m)</th>
            <th class="text-center">k</th>
        </tr>
        {% for p, c in baseline.certified_dist.items %}
            <tr>
                <td>{{p}}</td>
                <td>{{c.distance|floatformat:5}}</td>
                <td>{{c.combined_uncertainty|floatformat:5}}</td>
                <td>{{c.k_combined_uncertainty|floatformat:2}}</td>
                <td>{{c.offset|floatformat:3}}</td>
                <td>{{c.os_uncertainty|sigfigs:2}}</td>
                <td>{{c.k_os_uncertainty|floatformat:2}}</td>
                <td>{{c.reduced_level|floatformat:3}}</td>
                <td>{{c.rl_uncertainty|sigfigs:2}}</td>
                <td>{{c.k_rl_uncertainty|floatformat:2}}</td>
            </tr>
        {% endfor %}
    </table>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB flexbox-item-left_IB">
            <p>All certified distances are on the same horizontal plane at a reference height of {{ baseline.calibrated_baseline.get_average_pillar_height|floatformat:3 }} metres and on the same vertical plane running through the first and last stations.</p>
        </div>
    </div>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB flexbox-item-right_IB">
            <i>*k - Coverage factor for Expanded Uncertainty (95%)</i>
        </div>
    </div>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB  flexbox-item-left_IB">
            <hr>
        </div>
    </div>
</div>
<div>
    <h2 class="text-center">Least Squares Adjustment Summary</h2>
    <table style="margin-left:auto;margin-right:auto;font-size:10.0pt;width:800px;">
        <tr>
            <th>Description</th>
            <th>Value</th>
        </tr>
        <tr>
            <td class="text-left">Confidence Level</td>
            <td class="text-left">95%</td>
        </tr>
        <tr>
            <td class="text-left">A-priori Scale Factor Applied</td>
            <td class="text-left"> {{ pillar_survey.scalar|floatformat:2 }} </td>
        </tr>
        <tr>
            <td class="text-left">Estimated Variance Factor</td>
            <td class="text-left"> {{ chi_test.Variance|floatformat:2 }} </td>
        </tr>
        <tr>
            <td class="text-left">Experimental Standard Deviation (m)</td>
            <td class="text-left"> {{ chi_test.So|floatformat:5 }} </td>
        </tr>
        <tr>
            <td class="text-left">Number of Degrees of Freedom</td>
            <td class="text-left"> {{ chi_test.dof }}  </td>
        </tr>
        <tr>
            <td class="text-left">Coverage Factor</td>
            <td class="text-left"> {{ chi_test.k|floatformat:2 }} </td>
        </tr>
        <tr>
            <td class="text-left">Chi-Square Test of the Variance Factor &nbsp;&nbsp;&nbsp;&nbsp;({{ chi_test.chi_lower|floatformat:3 }} &#60 {{ chi_test.Variance|floatformat:3 }} &#60 {{ chi_test.chi_upper|floatformat:3 }}) </td>
            <td class="text-left">
                <B>{{ chi_test.test }}</B>
            </td>
        </tr>
    </table>
</div>
<div>
    <h2 class="text-center">Estimated Instrument Correction</h2>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB">
            <p>The estimated instrument correction (IC) is to be added to the slope distances measured by the EDMI set {{ pillar_survey.edm.edm_specs.edm_model.make.make }} {{ pillar_survey.edm.edm_specs.edm_model.model }} EDM instrument (S/N:{{ pillar_survey.edm.edm_number }}) and prism (S/N:{{ pillar_survey.prism.prism_number }}) using the following formula:</p>
            <p class="text-center">
                <B>IC = zpc + (scf - 1) * D</B>
            </p>
            <p>The corrected distance in metres is calculated using the following formula:<p>
            {% if parameters|length > 4 %}
                <p class="text-center">
                    <B>D' = zpc + scf * D + 1C * Sin(2 * &#8508 * D/U) + 2C * Cos(2 * &#8508 * D/U) + 3C * Sin(4 * &#8508 * D/U) + 4C * Cos(4 * &#8508 * D/U)</B>
                </p>
            {% elif parameters|length > 2 %}
                <p class="text-center">
                    <B>D' = zpc + scf * D + 1C * Sin(2 * &#8508 * D/U) + 2C * Cos(2 * &#8508 * D/U)</B>
                </p>
            {% else %}
                <p class="text-center">
                    <B>D' = zpc + scf * D</B>
                </p>
            {% endif %}
            <br>Where:
            <div style="margin-left: 5%; margin-top: 0; padding-top: 0;">
                IC = Instrument Correction (m)
                <br>D' = Corrected Distance (m)
                <br>D = Distance (m)
                <br>zpc = Zero Point Correction (m)
                <br>scf = Scale Correction Factor (A.x)
                {% if parameters|length > 2 %}
                    <br>U = Instrument Unit Length (m)
                    <br>1C = Cyclic error parameter 1 (m)
                    <br>2C = Cyclic error parameter 2 (m)
                    {% if parameters|length > 4 %}
                        <br>3C = Cyclic error parameter 3 (m)
                        <br>4C = Cyclic error parameter 4 (m)
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    <div>
        <br>
        <table style="margin-left:auto;margin-right:auto;font-size:10.0pt;width:800px;">
            <tr>
                <th>Term&nbsp;</th>
                <th class="text-center">Value</th>
                <th class="text-center">Uncertainty</th>
                {% if parameters|length > 2 %}
                    <th class="text-center">Null Hypothesis</th>
                    <th class="text-center">Insignificant</th>
                {% endif %}
            </tr>

            {% for parameter in parameters %}
                <tr>
                    {% if not chi_test.k is null %}
                        <td class="text-left">
                            <B>{{ parameter.term }}</B>
                        </td>
                        <td class="text-center">
                            {% if parameter.term == 'scf' %}
                                <B>{{ ini_edmi_certificate.scale_correction_factor|floatformat:8 }}</B>
                            {% else %}
                                <B>{{ parameter.value|floatformat:4 }}</B>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <B>{{ parameter.std_dev|multiply:chi_test.k|sigfigs:2 }}</B>
                        </td>
                        {% if parameters|length > 2 %}
                            <td class="text-center">{{ parameter.hypothesis }}</td>
                            <td class="text-center">{{ parameter.t_test }}</td>
                        {% endif %}
                    {% endif %}
                </tr>
            {% endfor %}
        </table>
    </div>
</div>
<div class="text-center">
    <h2>Statistical Tests</h2>
    <table style="margin-left:auto;margin-right:auto;font-size:10.0pt;width:800px;">
        <tr>
            <th class="text-center" style="width: 10%;">Test</th>
            <th class="text-center">Null Hypothesis</th>
            <th class="text-center">Confidence Level</th>
            <th class="text-center">Accept</th>
        </tr>
        {% for t in ISO_test %}
            <tr>
                <td>{{ t.test }}</td>
                {% if 'test_ranges' in t.keys %}
                    <td class="text-left">
                        <p>{{ t.hypothesis }}</p>
                        <table style="margin-left:auto;margin-right:auto;font-size:10.0pt;">
                            <tr>
                                <th>Distance (m)</th>
                                <th>Manufactureres Specifications (m)</th>
                                <th>Test Value (m)</th>
                                <th>Accept</th>
                            </tr>
                            {% for d in t.test_ranges %}
                                <tr>
                                    <td>{{ d.distance }}</td>
                                    <td>{{ d.Manu_Spec|floatformat:4 }}</td>
                                    <td>{{ d.test_value|floatformat:4 }}</td>
                                    <td>{{ d.accept }}</td>
                                </tr>
                            {% endfor %}
                        </table>
                    </td>
                {% else %}
                    <td class="text-left">{{ t.hypothesis|linebreaks }}</td>
                {% endif %}
            <td>95%</td>
            <td>{{ t.accept }}</td>
            </tr>
        {% endfor %}
    </table>
</div>
<div class="text-center">
    <h2>Calibration Distance Observations</h2>
    {% for o in edm_observations %}
        <table style="margin-left:auto;margin-right:auto;font-size:10.0pt;width:800px;">
            <tr style="border:0;font-weight:bold;">
                <td class="text-left">From Pillar</td>
                <td>{{o.from_pillar}}</td>
                <td></td>
                <td class="text-left">To Pillar</td>
                <td>{{o.to_pillar}}</td>
            </tr>
            <tr style="border:0;">
                <td class="text-left">Height above pillar</td>
                <td>{{o.inst_ht|floatformat:3}} m</td>
                <td></td>
                <td class="text-left">Height above pillar</td>
                <td>{{o.tgt_ht|floatformat:3}} m</td>
            </tr>
            <tr>
                <td class="text-left">Certified Slope Distance</td>
                <td>{{o.certified_slope_dist|floatformat:4}} m</td>
            </tr>
            <tr>
                <th></th>
                <th class="text-center">Slope Distance (m)</th>
                <th class="text-center">Temperature (Â°C)</th>
                <th class="text-center">Pressure (hPa)</th>
                <th class="text-center">Humidity (%)</th>
            </tr>
            {% for i in o.grp_bay %}
                {% if not i.slope_dist is null %}
                    <tr style="border:0;">
                        <td>{{forloop.counter}}</td>
                        <td>{{i.slope_dist|floatformat:4}}</td>
                        <td>{{i.Temp|floatformat:1}}</td>
                        <td>{{i.Pres|floatformat:1}}</td>
                        <td>{{i.Humid|floatformat:1}}</td>
                    </tr>
                {% endif %}
            {% endfor %}
            <tr style="border:1;"></tr>
            <tr>
                <td></td>
            </tr>
            <tr>
                <td class="text-left">Average</td>
                <td>{{o.slope_dist|floatformat:4}}</td>
                <td>{{o.Temp|floatformat:1}}</td>
                <td>{{o.Pres|floatformat:1}}</td>
                <td>{{o.Humid|floatformat:1}}</td>
            </tr>
            {% if not pillar_survey.thermo_calib_applied or not pillar_survey.baro_calib_applied or not pillar_survey.hygro_calib_applied %}
            <tr>
                <td class="text-left">Calibration Corrections</td>
                <td></td>
                <td>{{o.grp_bay.0.temp_calib_corr|floatformat:2}}</td>
                <td>{{o.grp_bay.0.pres_calib_corr|floatformat:2}}</td>
                <td>{{o.grp_bay.0.humi_calib_corr|floatformat:2}}</td>
            </tr>
            {% endif %}
            <tr>
                <td class="text-left">Standard Deviation</td>
                <td>{{o.std_slope_dist|floatformat:5}}</td>
            </tr>
        </table>
    {% endfor %}
</div>
<div class="text-center">
    <h2>Summary Table of Distance Reductions</h2>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB flexbox-item-left_IB">
            <p>All reduced distances are on the same horizontal plane at a reference height of {{ baseline.calibrated_baseline.get_average_pillar_height|floatformat:3 }} metres and on the same vertical plane running through the first and last stations.</p>
        </div>
    </div>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB flexbox-item-right_IB">
            <i>* Click the table headers to sort table</i>
        </div>
    </div>
    <div class="text-center">
        <table style="margin-left:auto;margin-right:auto;font-size:10.0pt;width:800px;">
            <thead>
                <tr>
                    <th class="text-center" colspan = '2'>Pillars</th>
                    <th class="text-center" rowspan = '1'>Averaged</th>
                    <th class="text-center" colspan = '3'>Corrections (mm)</th>
                    <th class="text-center" rowspan = '1'>Reduced</th>
                </tr>
                <tr>
                    <th onclick="sortTable(this)" class="text-center">From</th>
                    <th onclick="sortTable(this)" class="text-center">To</th>
                    <th onclick="sortTable(this)" class="text-center">Slope Distance (m)</th>
                    <!-- Corrections -->
                    <th onclick="sortTable(this)" class="text-center">Offset</th>
                    <th onclick="sortTable(this)" class="text-center">Slope</th>
                    <th onclick="sortTable(this)" class="text-center">Atmospheric</th>
                    <th onclick="sortTable(this)" class="text-center">Distance (m)</th>
                </tr>
            </thead>
            <tbody>
                {% for o in edm_observations %}
                    <tr>
                        <td>{{o.from_pillar}}</td>
                        <td>{{o.to_pillar}}</td>
                        <!-- Averaged raw -->
                        <td>{{o.raw_slope_dist|floatformat:5}}</td>
                        <!--Corrections-->
                        <td>{{o.Mets_Correction|multiply:1000|floatformat:2}}</td>
                        <td>{{o.Offset_Correction|multiply:1000|floatformat:2}}</td>
                        <td>{{o.Slope_Correction|multiply:1000|floatformat:2}}</td>
                        <td>{{o.Reduced_distance|floatformat:5}}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<div class="text-center">
    <h2>Summary Table of Apriori Standard Deviation Contributions</h2>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB flexbox-item-right_IB">
            <i>* Click the table headers to sort table</i>
        </div>
    </div>
    <div class="text-center">
        <table style="margin-left:auto;margin-right:auto;font-size:10.0pt;width:800px;">
            <thead>
                {% with edm_observations|first as o %}
                    <tr>
                        <th class="text-center" colspan = '2'>Pillars</th>
                        <th class="text-center" colspan = '{{ o.uc_budget|length }}'>Standard Deviation (mm)</th>
                    </tr>
                    <tr>
                        <th onclick="sortTable(this)" class="text-center">From</th>
                        <th onclick="sortTable(this)" class="text-center">To</th>
                        {% for s in o.apriori_uc_budget.values %}
                            <th onclick="sortTable(this)" class="text-center">{{ s.group_verbose }}</th>
                        {% endfor %}
                    </tr>
                {% endwith %}
            </thead>
            <tbody>
                {% for o in edm_observations %}
                    <tr>
                        <td>{{o.from_pillar}}</td>
                        <td>{{o.to_pillar}}</td>
                        <!--Uncertainties-->
                        {% for s in o.apriori_uc_budget.values %}
                            {% if not s.units == 'm' %}
                                <td>{{ s.std_dev|sigfigs:2 }}</td>
                            {% else %}
                                <td>{{ s.std_dev|multiply:1000|sigfigs:2 }}</td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<div class="text-center">
    <h2>Uncertainty Budget - Uncertainty Sources</h2>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB flexbox-item-left_IB">
            <p>The quantity of some uncertainties are distance dependent. Thus, the following two tables relate to the uncertainty budget for the longest observed distance only.</p>
        </div>
    </div>
    <table style="margin-left:auto;margin-right:auto;font-size:10.0pt;width:800px;">
        <tr>
            <th>Group</th>
            <th>Description</th>
            <th>Apriori</th>
            <th>Type</th>
            <th>Distrubution</th>
            <th>Uncertainty</th>
            <th>Units</th>
            <th>Coverage Factor</th>
            <th>Degrees of Freedom</th>
        </tr>
        {% for s in first_to_last.uc_sources %}
            <tr>
                <td class="text-left">{{ s.group_verbose }}</td>
                <td class="text-left">{{ s.description }}</td>
                <td>{% if s.apriori == False %}No{% else %}Yes{% endif %}</td>
                <td>{{ s.ab_type }}</td>
                <td>{{ s.distribution }}</td>
                {% if not s.units == 'm' %}
                    <td>{{ s.std_dev|multiply:s.k|sigfigs:2 }}</td>
                    <td>{{ s.units }}</td>
                {% else %}
                    <td>{{ s.std_dev|multiply:s.k|multiply:1000|sigfigs:2 }}</td>
                    <td>mm</td>
                {% endif %}
                <td>{{ s.k|floatformat:2 }}</td>
                <td>{{ s.degrees_of_freedom }}</td>
            </tr>
        {% endfor %}
    </table>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB flexbox-item-right_IB">
            <i> Note apriori uncertainties have been used to weight observations in the least squares adjustment.</i>
        </div>
    </div>
</div>
<div class="text-center">
    <h2>Combined Uncertainty Budget - Total Distance Uncertainty</h2>
    <table style="margin-left:auto;margin-right:auto;font-size:10.0pt;width:800px;">
        <tr>
            <th>Group</th>
            <th>Uncertainty</th>
            <th>Units</th>
            <th>Coverage Factor</th>
            <th>Degrees of Freedom</th>
            <th>Contribution to TDU* (mm)</th>
        </tr>
        {% for s in first_to_last.uc_budget.values %}
            <tr>
                <td class="text-left">{{ s.group_verbose }}</td>
                {% if not s.units == 'm' %}
                    <td>{{ s.std_dev|multiply:s.k|sigfigs:2 }}</td>
                    <td>{{ s.units }}</td>
                {% else %}
                    <td>{{ s.std_dev|multiply:s.k|multiply:1000|sigfigs:2 }}</td>
                    <td>mm</td>
                {% endif %}
                <td>{{ s.k|floatformat:2 }}</td>
                <td>{{ s.degrees_of_freedom|floatformat:2 }}</td>
                <td>{{ s.ui95|multiply:1000|sigfigs:2 }}</td>
            </tr>
        {% endfor %}
    </table>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB flexbox-item-right_IB">
            <i>*TDU - Total Distance Uncertainty</i>
        </div>
    </div>
    <div class="text-center">
        <h2>Uncertainty Groups Contribution to Certified Distances</h2>
        <div id="charts" class="flex flex-col justify-end items-center">
            <canvas id="Uncertainty-Chart" style="max-width:800px;height:800px"></canvas>
        </div>
    </div>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB flexbox-item-right_IB">
            <i>* Click on legend items to toggle display</i>
        </div>
    </div>
</div>
<div class="text-center">
    <h2>Table of Observations, Corrections, Uncertainties and Residuals</h2>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB flexbox-item-right_IB">
            <i>* Click the table headers to sort table</i>
        </div>
    </div>
    <div class="text-center" style="overflow: scroll">
        <table id="myTable" border="1" style=";margin-left:auto;margin-right:auto;font-size:10.0pt;">
            <thead>
            {% with edm_observations|first as o %}
                <tr>
                    <th class="text-center" colspan = '2'>Pillars</th>
                    <th class="text-center" colspan = {{ o.grp_bay|length }}>Raw Distances (m)</th>
                    <th class="text-center" colspan = '3'>Average Distance</th>
                    <th class="text-center" colspan = '2'>Bay (m)</th>
                    <th class="text-center" colspan = '3'>Corrections (mm)</th>
                    <th class="text-center" colspan = '1'></th>
                    <th class="text-center" colspan = '{{ o.uc_budget.values|length|add:1 }}'>Uncertainties (mm)</th>
                    <th class="text-center" colspan = '2'>Residuals</th>
                </tr>
                <tr>
                    <th onclick="sortTable(this)" class="text-center">From</th>
                    <th onclick="sortTable(this)" class="text-center">To</th>
                    {% for s in edm_observations.0.grp_bay %}
                        <th onclick="sortTable(this)" class="text-center">Slope Dist. {{ forloop.counter }}</th>
                    {% endfor %}
                    <th onclick="sortTable(this)" class="text-center">Slope Dist. (m)</th>
                    <th onclick="sortTable(this)" class="text-center">Dist. Std Dev (mm)</th>
                    <th onclick="sortTable(this)" class="text-center">Difference to Certified (mm)</th>
                    <th onclick="sortTable(this)" class="text-center">Offset</th>
                    <th onclick="sortTable(this)" class="text-center">Delta Height</th>
                    <!-- Corrections -->
                    <th onclick="sortTable(this)" class="text-center">Atmospheric</th>
                    <th onclick="sortTable(this)" class="text-center">Offset</th>
                    <th onclick="sortTable(this)" class="text-center">Slope</th>
                    <th onclick="sortTable(this)" class="text-center">Reduced Distance (m)</th>
                    <!-- Uncertainty -->
                    {% for s in o.uc_budget.values %}
                        <th onclick="sortTable(this)" class="text-center">{{ s.group_verbose }}</th>
                    {% endfor %}
                    <th onclick="sortTable(this)" class="text-center">Total</th>
                    <!--LSA residuals -->
                    <th onclick="sortTable(this)" class="text-center">Residual (mm)</th>
                    <th onclick="sortTable(this)" class="text-center">Standard Residual</th>
                </tr>
            {% endwith %}
            </thead>
            <tbody>
                {% for o in edm_observations %}
                    <tr>
                        <td>{{o.from_pillar}}</td>
                        <td>{{o.to_pillar}}</td>
                        <!--Raw-->
                        {% for s in o.grp_bay %}
                            <td>{{s.raw_slope_dist|floatformat:4}}</td>
                        {% endfor %}
                        <!--Avg, Std-->
                        <td>{{o.raw_slope_dist|floatformat:5}}</td>
                        <td>{{o.std_slope_dist|multiply:1000|floatformat:2}}</td>
                        <td>{{o.diff_to_certified_sd|multiply:1000|floatformat:2}}</td>
                        <!--OS, Delta Ht-->
                        <td>{{o.delta_os|floatformat:3}}</td>
                        <td>{{o.delta_height|floatformat:3}}</td>
                        <!--Corrections-->
                        <td>{{o.Mets_Correction|multiply:1000|floatformat:2}}</td>
                        <td>{{o.Offset_Correction|multiply:1000|floatformat:2}}</td>
                        <td>{{o.Slope_Correction|multiply:1000|floatformat:2}}</td>
                        <td>{{o.Reduced_distance|floatformat:5}}</td>
                        <!--Uncertainty-->
                        {% for s in o.uc_budget.values %}
                            <td>{{s.ui95|multiply:1000|floatformat:2}}</td>
                        {% endfor %}
                        <td>{{o.uc_combined.uc95|multiply:1000|floatformat:2}}</td>
                        <td>{{o.residual|multiply:1000|floatformat:2}}</td>
                        <td>{{o.std_residual|floatformat:2}}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% if iso_full_test.matrix_y %}
<div class="text-center">
    <h2 class="text-center">ISO 17123:4 Full Test Procedure Results</h2>
    <p class="text-center"><i>For more information about ISO full test procedure refer to the technical manual <a href= "{% url 'calibrationguide:read_manual' manual_name='edmi_calibration_manual.html' %}#EDMI-Chapter3_4" target="_blank" onclick="return PopupTechnicalManual(this);"> &#x1F6C8</a></i></p>
    <table style="margin-left:auto;margin-right:auto;font-size:10.0pt;width:800px;">
        <tr>
            <th colspan="2" class="text-center">Pillars</th>
            <th rowspan="2" class="text-center" style="vertical-align: middle;">Value (m)</th>
            <th rowspan="2" class="text-center" style="vertical-align: middle;">Standard Deviation (mm)</th>
            <th rowspan="2" class="text-center" style="vertical-align: middle;">Uncertainty (mm)</th>
        </tr>
        <tr>
            <th>From</th>
            <th>To</th>
        </tr>
        {% for parameter in iso_full_test.matrix_y %}
            <tr>
                {% if "zero-point correction" in parameter.term %}
                    <td></td></tr>
                    <tr>
                    <td colspan="2" class="text-right"><b>{{ parameter.term|title }}:</b></td>
                {% else %}
                    <td>{{ parameter.from_pillar }}</td>
                    <td>{{ parameter.to_pillar }}</td>
                {% endif %}
                <td>{{ parameter.value|floatformat:4 }}</td>
                <td>{{ parameter.std_dev|floatformat:2 }}</td>
                <td>{{ parameter.uncertainty|floatformat:2 }}</td>
            </tr>
        {% endfor %}
    </table>
</div>
<div class="text-center">
    <h2 class="text-center">ISO 17123:4 Full Test Procedure Least Squares Adjustment Summary</h2>
    <table style="margin-left:auto;margin-right:auto;font-size:10.0pt;width:800px;">
        <tr>
            <th>Description</th>
            <th>Value</th>
        </tr>
        <tr>
            <td class="text-left">Confidence Level</td>
            <td class="text-left">95%</td>
        </tr>
        <tr>
            <td class="text-left">Experimental Standard Deviation (m)</td>
            <td class="text-left"> {{ iso_full_test.chi_test.So|floatformat:5 }} </td>
        </tr>
        <tr>
            <td class="text-left">Number of Degrees of Freedom</td>
            <td class="text-left"> {{ iso_full_test.chi_test.dof }}  </td>
        </tr>
        <tr>
            <td class="text-left">Coverage Factor</td>
            <td class="text-left"> {{ iso_full_test.chi_test.k|floatformat:2 }} </td>
        </tr>
    </table>
</div>
{% endif %}
<div class="text-center">
    <h2>Residuals From Least Squares Fit of The Baseline Measurements</h2>
    <div id="charts" class="flex flex-col justify-end items-center">
        <canvas id="Residual-Chart" style="width:100%;max-width:800px"></canvas>
    </div>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB flexbox-item-right_IB">
            <i> Note potential outliers indicated in </i>
            <i style="color:red">(*) red</i>
            <i> if detected</i>
        </div>
    </div>
</div>
<div class="text-center">
    <h2>Comparison of Raw Observations to Certified Slope Distances</h2>
    <div id="charts" class="flex flex-col justify-end items-center">
        <canvas id="surveyed-vs-certified-Chart" style="max-width:800px"></canvas>
    </div>
</div>
{% if pillar_survey.edm.edm_specs.unit_length %}
<div class="text-center">
    <h2>Return Phase Angle of Observed Distances</h2>
    <div id="charts" class="flex flex-col justify-end items-center">
        <canvas id="return-phase-angle-Chart" style="max-width:800px"></canvas>
    </div>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB flexbox-item-right_IB">
            <i> Note data points require an even distribution over half the wavelength to suitably test for cyclic errors.</i>
        </div>
    </div>
</div>
{% endif %}
<div class="text-center">
    <h2>EDMI Calibration History</h2>
    <table style="margin-left:auto;margin-right:auto;font-size:10.0pt;width:800px;">
        <tr>
            <th>Date</th>
            <th colspan = 2>Zero Point Correction (m)</th>
            <th colspan = 2>Scale Correction Factor (A.x)</th>
            <th colspan = 2>1C (m)</th>
            <th colspan = 2>2C (m)</th>
            <th colspan = 2>3C (m)</th>
            <th colspan = 2>4C (m)</th>
        </tr>
        <tr>
            <th></th>
            <th>Value</th>
            <th>UC</th>
            <th>Value</th>
            <th>UC</th>
            <th>Value</th>
            <th>UC</th>
            <th>Value</th>
            <th>UC</th>
            <th>Value</th>
            <th>UC</th>
            <th>Value</th>
            <th>UC</th>
        </tr>

        {% with ini_edmi_certificate as form %}
         <tr class="text-left">
            <td>{{ form.calibration_date }}</td>
            <td>{{ form.zero_point_correction|floatformat:5 }}</td>
            <td>{{ form.zpc_uncertainty|floatformat:5 }}</td>
            <td>{{ form.scale_correction_factor|floatformat:8 }}</td>
            <td>{{ form.scf_uncertainty|sigfigs:2 }}</td>
            {% if form.has_cyclic_corrections %}
                <td>{{ form.cyclic_one|floatformat:5 }}</td>
                <td>{{ form.cyc_1_uncertainty|sigfigs:2 }}</td>
                <td>{{ form.cyclic_two|floatformat:5 }}</td>
                <td>{{ form.cyc_2_uncertainty|sigfigs:2 }}</td>
                <td>{{ form.cyclic_three|floatformat:5 }}</td>
                <td>{{ form.cyc_3_uncertainty|sigfigs:2 }}</td>
                <td>{{ form.cyclic_four|floatformat:5 }}</td>
                <td>{{ form.cyc_4_uncertainty|sigfigs:2 }}</td>
            {% else %}
                <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
            {% endif %}
         </tr>
        {% endwith %}

        {% for certificate in calib.edmi %}
         <tr class="text-left">
            <td>{{ certificate.calibration_date }}</td>
            <td>{{ certificate.zero_point_correction|floatformat:5 }}</td>
            <td>{{ certificate.zpc_uncertainty|floatformat:5 }}</td>
            <td>{{ certificate.scale_correction_factor|floatformat:8 }}</td>
            <td>{{ certificate.scf_uncertainty|sigfigs:2 }}</td>
            {% if certificate.has_cyclic_corrections %}
                <td>{{ certificate.cyclic_one|floatformat:5 }}</td>
                <td>{{ certificate.cyc_1_uncertainty|sigfigs:2 }}</td>
                <td>{{ certificate.cyclic_two|floatformat:5 }}</td>
                <td>{{ certificate.cyc_2_uncertainty|sigfigs:2 }}</td>
                <td>{{ certificate.cyclic_three|floatformat:5 }}</td>
                <td>{{ certificate.cyc_3_uncertainty|sigfigs:2 }}</td>
                <td>{{ certificate.cyclic_four|floatformat:5 }}</td>
                <td>{{ certificate.cyc_4_uncertainty|sigfigs:2 }}</td>
            {% else %}
                <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
            {% endif %}
         </tr>
        {% endfor %}
    </table>
</div>
<div class="text-center">
    <h2>Report Notes</h2>
    <div class="flexbox-container_IB">
        <!-- NB. tables contained in these notes are formated in common_func>Convert.py -->
        <div class="flexbox-item_800_IB flexbox-item-left_IB">
            {% for n in report_notes %}
                <p>{{forloop.counter}}. {{ n|safe }}</p>
            {% empty %}
                <p>No report notes to display.</p>
            {% endfor %}
        </div>
    </div>
</div>
<div class="text-center">
    <h2>Data Warnings</h2>
    <div class="flexbox-container_IB">
        <div class="flexbox-item_800_IB flexbox-item-left_IB">
            {% for w in Check_Errors.Warnings %}
                <p>{{forloop.counter}}. {{w}}</p>
            {% empty %}
                <p>No data warnings to display.</p>
            {% endfor %}
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@0.1.2"></script>
<!-- <script src="{% static 'js/tables.js' %}"></script> -->

<script>
// "Populate the javascript lists and arrays for all the charts"
let dColour = [];
let lbls0 = [];
let Data0 =[];
let lbls1 = [];
let Data1 =[];
let lbls2 = [];
let Data2 =[];
let distances = [];
let lbls3 = [];
let bay = "";
{% for o in edm_observations %}
    //"Residual Chart"
    bay = "({{ o.from_pillar }} - {{ o.to_pillar }})";
    if (Math.abs({{ o.std_residual }}) > {{pillar_survey.outlier_criterion}}) {
        dColour.push("#FF0000");
        lbls0.push("Potential Outlier: " + bay + " Standarized Residual: " + {{ o.std_residual }}.toFixed(2));
    } else {
        dColour.push("#0033CC");
        lbls0.push( bay + " Standarized Residual: " + {{ o.std_residual }}.toFixed(2));
    }
    Data0.push({x: {{ o.Reduced_distance }}.toFixed(5),
                y: ({{ o.residual }}*1000).toFixed(2)});
    // "Uncertainty-Chart"
    Data1.push({
      label: bay + " " + {{ o.Reduced_distance }}.toFixed(4) + "m",
      barPercentage: 0.8,
      backgroundColor: [
        {% for uc in o.uc_budget.values %}'{{ uc.chart_colour }}', {% endfor %}],
      data: [
        {% for uc in o.uc_budget.values %}
          {{ uc.ui95|multiply:1000|sigfigs:2 }},{% endfor %}]
    });

    // "Surveyed-vs-certified-Chart"
    lbls2.push(bay + " " + ({{ o.diff_to_certified_sd }}*1000).toFixed(2));
    Data2.push({x: {{ o.slope_dist }}.toFixed(5),
                y: ({{ o.diff_to_certified_sd }}*1000).toFixed(2)});
    // "return phase angle plot"
    distances.push({{ o.slope_dist }});
    lbls3.push(bay + " " + {{ o.Reduced_distance }}.toFixed(4) + "m");

{% endfor %}
</script>
<script>
// "Script to generate the Residuals scatter plot"

new Chart("Residual-Chart", {
  type: "scatter",
  data: {
    labels: lbls0,
    datasets: [{
      pointRadius: 2,
      pointHoverRadius: 5,
      pointBackgroundColor: dColour,
      data: Data0,
      fill: false,
      tension: 0
    }]
  },
  options: {
    legend: {display: false},
    tooltips: {
           callbacks: {
              label: function(tooltipItem, data) {
                 var label = data.labels[tooltipItem.index];
                 return label;
              }
           }
        },
    scales: {
      xAxes: [{
          scaleLabel: {display: true,
            labelString: 'Distance (m)'}
      }],
      yAxes: [{
          scaleLabel: {display: true,
             labelString: 'Residuals (mm)'}
      }],
    }
  }
});
</script>
<script>
// "Script to produce the bar chart for Uncertainty"
new Chart("Uncertainty-Chart", {
    type: 'horizontalBar',
    data: {
      labels: [
    {% for uc in edm_observations.0.uc_budget.values %}
          '{{ uc.group_verbose|safe }}',{% endfor %}],
      datasets: Data1
    },
    options: {
      legend: { display: true },
      scales: {
        xAxes: [{
               scaleLabel: {display: true,
               labelString: 'Uncertainty (mm)'}
        }]
        }}
});

</script>
<script>
"// Script to produce the Comparison of surveyed and certified distances"

new Chart(document.getElementById("surveyed-vs-certified-Chart"), {
    type: "scatter",
    data: {
      labels: lbls2,
      datasets: [{
        pointRadius: 2,
        pointHoverRadius: 5,
        pointBackgroundColor: dColour,
        data: Data2,
        fill: false,
        tension: 0}
      ]
    },
    options: {
      legend: {display: false},
      tooltips: {
             callbacks: {
                label: function(tooltipItem, data) {
                   var label = data.labels[tooltipItem.index];
                   return label;
                }
             }
          },
      scales: {
        xAxes: [{
            scaleLabel: {display: true,
              labelString: 'Distance (m)'}
        }],
        yAxes: [{
            scaleLabel: {display: true,
               labelString: 'Difference (mm)'}
        }],
      }
    }
});

</script>
{% if pillar_survey.edm.edm_specs.unit_length %}
<script>
// Script to produce the Return Phase Angle Chart
let Sinewave = [];
for (let a = 0; a
    <= 360; a+=5) {
    let r = a * Math.PI/180;
    Sinewave.push({x:a, y:Math.sin(r)});
};
let cht_datasets = [{
  label: 'Sinewave',
  pointRadius: 0,
  borderColor: 'blue',
  borderWidth: 1,
  data: Sinewave,
  showLine: true,
  fill: false,
  tension: 0
}];

for (let d = 0; d <= distances.length-1; d++) {
    Inter = Number.parseInt(distances[d] / {{ pillar_survey.edm.edm_specs.unit_length }},10);
    fract = distances[d] - (Inter*{{ pillar_survey.edm.edm_specs.unit_length }});
    fract_prop = fract / {{ pillar_survey.edm.edm_specs.unit_length }};
    return_phase_ang = fract_prop * 360;
    cht_datasets.push({
      label: lbls3[d],
      pointRadius: 1.5,
      borderColor: 'black',
      borderWidth: 1,
      data: [{x:return_phase_ang, y:-1},{x:return_phase_ang, y:1}],
      showLine: true,
      fill: false,
      tension: 0
    });
};

new Chart("return-phase-angle-Chart", {
  type: "scatter",
  data: {
    datasets: cht_datasets
  },
  options: {
    legend: {display: true},
    tooltips: {
           callbacks: {
              label: function(tooltipItem) {
                 var label = lbls3[tooltipItem.datasetIndex-1];
                 return label;
              }
           }
        },
    scales: {
      xAxes: [{
          scaleLabel: {display: true,
            labelString: 'Phase Angle (Â°)'},
         ticks: {
            stepSize: 45,
            max: 360,}
      }],
      yAxes: [{
          scaleLabel: {display: true,
             labelString: 'Amplitude'}
      }],
    }
  }
});

</script>
{% endif %}

<script>
document.addEventListener("DOMContentLoaded", function() {
    // certificate()
    });

// Function to change an EDMI report to a certificate
function certificate(){
    // Script to switch between Report and certificate
    hide_heading = [
        "Statistical Tests",
        "Calibration Distance Observations",
        "Uncertainty Budget - Uncertainty Sources",
        "Summary Table of Distance Reductions",
        "Summary Table of Apriori Standard Deviation Contributions",
        "ISO 17123:4 Full Test Procedure Results",
        "ISO 17123:4 Full Test Procedure Least Squares Adjustment Summary",
        "Combined Uncertainty Budget - Total Distance Uncertainty",
        "Uncertainty Groups Contribution to Certified Distances",
        "Table of Observations, Corrections, Uncertainties and Residuals",
        "Residuals From Least Squares Fit of The Baseline Measurements",
        "Return Phase Angle of Observed Distances"];

    // Get all <h> elements </h>
    var h2Elements = document.querySelectorAll("h2");
    var h1Elements = document.querySelectorAll("h1");

    h1Elements[0].innerHTML = "<B>EDMI Calibration Certificate</B>";

    // Check if the content of the <h2></h2> element is in the array of headers
    h2Elements.forEach(function(h2Element) {
        if (hide_heading.includes(h2Element.textContent.trim())) {
            var parentElement = h2Element.parentNode;

            // Hide the parent element
            parentElement.style.display = "none";
        }
    })
}
</script>
